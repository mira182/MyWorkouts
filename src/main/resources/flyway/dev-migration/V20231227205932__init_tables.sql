CREATE TABLE IF NOT EXISTS privilege
(
    id   SERIAL PRIMARY KEY,
    name VARCHAR(255)
);

CREATE TABLE IF NOT EXISTS role
(
    id   SERIAL PRIMARY KEY,
    name VARCHAR(255)
);

CREATE TABLE IF NOT EXISTS role_privilege
(
    privilege_id BIGINT NOT NULL,
    role_id      BIGINT NOT NULL
);

CREATE TABLE IF NOT EXISTS tanita_last_update
(
    id      BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    updated TIMESTAMP WITHOUT TIME ZONE
);

CREATE TABLE IF NOT EXISTS tanita_measurement
(
    id                SERIAL PRIMARY KEY,
    date              TIMESTAMP WITHOUT TIME ZONE,
    weight            DOUBLE PRECISION                        NOT NULL,
    bmi               DOUBLE PRECISION                        NOT NULL,
    body_fat          DOUBLE PRECISION                        NOT NULL,
    body_fat_mass     DOUBLE PRECISION                        NOT NULL,
    visceral_fat      DOUBLE PRECISION                        NOT NULL,
    muscle_mass       DOUBLE PRECISION                        NOT NULL,
    muscle_mass_ratio DOUBLE PRECISION                        NOT NULL,
    muscle_quality    DOUBLE PRECISION                        NOT NULL,
    bone_mass         DOUBLE PRECISION                        NOT NULL,
    bmr               DOUBLE PRECISION                        NOT NULL,
    metabolic_age     DOUBLE PRECISION                        NOT NULL,
    body_watter       DOUBLE PRECISION                        NOT NULL,
    body_watter_mass  DOUBLE PRECISION                        NOT NULL,
    physique_rating   DOUBLE PRECISION                        NOT NULL
);

CREATE TABLE IF NOT EXISTS "user"
(
    id         SERIAL PRIMARY KEY,
    username   VARCHAR(255),
    password   VARCHAR(255),
    email      VARCHAR(255),
    first_name VARCHAR(255),
    last_name  VARCHAR(255)
);

CREATE TABLE IF NOT EXISTS user_role
(
    role_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL
);

CREATE TABLE IF NOT EXISTS withings_measurements
(
    id                SERIAL PRIMARY KEY,
    date              TIMESTAMP WITHOUT TIME ZONE,
    weight            DOUBLE PRECISION                        NOT NULL,
    fat_free_mass     DOUBLE PRECISION                        NOT NULL,
    fat_ratio         DOUBLE PRECISION                        NOT NULL,
    fat_mass_weight   DOUBLE PRECISION                        NOT NULL,
    muscle_mass       DOUBLE PRECISION                        NOT NULL,
    muscle_mass_ratio DOUBLE PRECISION                        NOT NULL,
    hydration         DOUBLE PRECISION                        NOT NULL,
    hydration_ratio   DOUBLE PRECISION                        NOT NULL,
    bone_mass         DOUBLE PRECISION                        NOT NULL,
    bmi               DOUBLE PRECISION                        NOT NULL
);

ALTER TABLE "user"
    ADD CONSTRAINT uc_user_email UNIQUE (email);

ALTER TABLE "user"
    ADD CONSTRAINT uc_user_username UNIQUE (username);

ALTER TABLE role_privilege
    ADD CONSTRAINT fk_rolpri_on_privilege FOREIGN KEY (privilege_id) REFERENCES privilege (id);

ALTER TABLE role_privilege
    ADD CONSTRAINT fk_rolpri_on_role FOREIGN KEY (role_id) REFERENCES role (id);

ALTER TABLE user_role
    ADD CONSTRAINT fk_user_role_on_role FOREIGN KEY (role_id) REFERENCES role (id);

ALTER TABLE user_role
    ADD CONSTRAINT fk_user_role_on_user FOREIGN KEY (user_id) REFERENCES "user" (id);